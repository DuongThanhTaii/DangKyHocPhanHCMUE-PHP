# ğŸš€ MIGRATION PLAN: Django Clean Architecture

## ğŸ“‹ Phase 1: Foundation & Authentication (CURRENT)

### Step 1: Models Setup âœ…

- [x] Generate models tá»« Neon DB
- [x] Copy models vÃ o `infrastructure/persistence/models.py`
- [x] Configure database routing

### Step 2: Authentication Use Case ğŸ¯ âœ…

**Priority: HIGH | Complexity: LOW | Status: DONE**

#### API Endpoints Implemented:

- POST `/api/auth/login` - Login vÃ  láº¥y JWT token âœ…
- POST `/api/auth/refresh` - Refresh token âœ…

---

## ğŸ“‹ Phase 2: Core Domain Models & API Endpoints

### Danh Má»¥c (Master Data) - Common APIs

**Status: IMPLEMENTED** âœ…

```
GET  /api/hoc-ky-hien-hanh                   - Get current semester âœ…
GET  /api/hien-hanh                          - Get current semester (alias) âœ…
GET  /api/hoc-ky/dates                       - Get semester dates âœ…
GET  /api/dm/khoa                            - Get list of khoa (departments) âœ…
GET  /api/dm/nganh                           - Get list of nganh (specializations) âœ…
GET  /api/dm/nganh/chua-co-chinh-sach        - Get specializations without policy âœ…
GET  /api/config/tiet-hoc                    - Get class time config âœ…
```

### Step 3: Sinh ViÃªn Module

**Status: IMPLEMENTED** âœ…

```
GET  /api/sv/profile                     - Get student profile âœ…
GET  /api/sv/lop-hoc-phan/{id}/tai-lieu  - Get documents for class âœ…
GET  /api/sv/lop-hoc-phan/{id}/tai-lieu/{doc_id}/download  - Download document âœ…
```

### Step 4: Enrollment (Ghi Danh) Flow

**Status: IMPLEMENTED** âœ…

```
GET  /api/sv/check-ghi-danh              - Check if can enroll âœ…
GET  /api/sv/mon-hoc-ghi-danh            - Get subjects to enroll âœ…
POST /api/sv/ghi-danh                    - Enroll in subjects âœ…
GET  /api/sv/ghi-danh/my                 - Get enrolled subjects list âœ…
```

### Step 5: Course Registration (ÄÄƒng KÃ½ Há»c Pháº§n) Flow

**Status: IMPLEMENTED** âœ…

```
GET  /api/sv/check-phase-dang-ky         - Check if registration phase is open âœ…
GET  /api/sv/lop-hoc-phan                - Get list of classes to register âœ…
GET  /api/sv/lop-da-dang-ky              - Get registered classes list âœ…
POST /api/sv/dang-ky-hoc-phan            - Register for class âœ…
POST /api/sv/huy-dang-ky-hoc-phan        - Unregister from class âœ…
POST /api/sv/chuyen-lop-hoc-phan         - Transfer to another class âœ…
GET  /api/sv/lop-hoc-phan/mon-hoc        - Get classes by subject âœ…
GET  /api/sv/lich-su-dang-ky             - Get registration history âœ…
GET  /api/sv/tkb-weekly                  - Get weekly schedule âœ…
GET  /api/sv/tra-cuu-hoc-phan            - Search classes âœ…
GET  /api/sv/hoc-phi                     - Get tuition details âœ…
GET  /api/sv/lop-hoc-phan/{id}/tai-lieu  - Get documents for class âœ…
GET  /api/sv/lop-da-dang-ky/tai-lieu     - Get documents for registered classes âœ…
```

### Step 6: Payment Module

**Status: IMPLEMENTED** âœ…

```
POST /api/payment/create                 - Create payment order (VNPay/MoMo) âœ…
GET  /api/payment/status                 - Get payment status âœ…
POST /api/payment/ipn                    - Payment IPN callback handler âœ…
```

### Step 7: Giáº£ng ViÃªn (GV) Module

**Status: IMPLEMENTED** âœ…

```
GET  /api/gv/lop-hoc-phan                - Get instructor's classes âœ…
GET  /api/gv/lop-hoc-phan/{id}           - Get class details âœ…
GET  /api/gv/lop-hoc-phan/{id}/sinh-vien - Get class students âœ…
GET  /api/gv/lop-hoc-phan/{id}/diem      - Get/update student grades âœ…
GET  /api/gv/lop-hoc-phan/{id}/tai-lieu  - Get class documents list âœ…
POST /api/gv/lop-hoc-phan/{id}/tai-lieu/upload - Upload document âœ…
GET  /api/gv/lop-hoc-phan/{id}/tai-lieu/{doc_id} - Get document details âœ…
GET  /api/gv/lop-hoc-phan/{id}/tai-lieu/{doc_id}/download - Download document âœ…
GET  /api/gv/tkb-weekly                  - Get instructor schedule âœ…
```

### Step 8: Trá»£ LÃ½ Khoa (TLK) Module

**Status: IMPLEMENTED** âœ…

```
GET  /api/tlk/mon-hoc                    - Get list of courses âœ…
GET  /api/tlk/giang-vien                 - Get list of instructors âœ…
GET  /api/tlk/lop-hoc-phan/get-hoc-phan/{hoc_ky_id} - Get courses for semester âœ…
GET  /api/tlk/phong-hoc                  - Get list of rooms âœ…
GET  /api/tlk/phong-hoc/available        - Get available rooms âœ…
GET  /api/tlk/de-xuat-hoc-phan           - Get course proposals (view only) âœ…
POST /api/tlk/thoi-khoa-bieu/batch       - Batch schedule assignments âœ…
POST /api/tlk/thoi-khoa-bieu             - Create/update schedule âœ…
```

### Step 9: TrÆ°á»Ÿng Khoa (TK) Module

**Status: IMPLEMENTED** âœ…

```
GET  /api/tk/de-xuat-hoc-phan            - Get course proposals (view only) âœ…
POST /api/tk/de-xuat-hoc-phan/duyet      - Approve course proposal âœ…
POST /api/tk/de-xuat-hoc-phan/tu-choi    - Reject course proposal âœ…
```

### Step 10: PDT (PhÃ²ng ÄÃ o Táº¡o) Management Module

**Status: IMPLEMENTED** âœ…

```
POST /api/pdt/quan-ly-hoc-ky/hoc-ky-hien-hanh      - Set current semester âœ…
POST /api/pdt/quan-ly-hoc-ky/ky-phase/bulk         - Create semester phases âœ…
GET  /api/pdt/quan-ly-hoc-ky/ky-phase/{hoc_ky_id}  - Get phases by semester âœ…
GET  /api/pdt/de-xuat-hoc-phan                     - Get course proposals âœ…
POST /api/pdt/de-xuat-hoc-phan                     - Create course proposal âœ…
POST /api/pdt/de-xuat-hoc-phan/duyet               - Approve proposal âœ…
POST /api/pdt/de-xuat-hoc-phan/tu-choi             - Reject proposal âœ…
POST /api/pdt/dot-ghi-danh/update                  - Update enrollment period âœ…
GET  /api/pdt/dot-dang-ky/{hoc_ky_id}              - Get periods by semester âœ…
GET  /api/pdt/dot-dang-ky                          - Get all periods âœ…
GET  /api/pdt/khoa                                 - Get departments list âœ…
GET  /api/pdt/phong-hoc/available                  - Get available rooms âœ…
GET  /api/pdt/phong-hoc/khoa/{khoa_id}             - Get rooms by department âœ…
POST /api/pdt/phong-hoc/assign                     - Assign room to class âœ…
POST /api/pdt/phong-hoc/unassign                   - Unassign room âœ…
POST /api/pdt/chinh-sach-tin-chi                   - Create tuition policy âœ…
GET  /api/pdt/chinh-sach-tin-chi                   - Get tuition policies âœ…
GET  /api/pdt/chinh-sach-tin-chi/{id}              - Get policy details âœ…
PUT  /api/pdt/chinh-sach-tin-chi/{id}              - Update policy âœ…
DELETE /api/pdt/chinh-sach-tin-chi/{id}            - Delete policy âœ…
POST /api/pdt/hoc-phi/tinh-toan-hang-loat          - Calculate tuition batch âœ…
POST /api/pdt/sinh-vien                            - Create student âœ…
GET  /api/pdt/sinh-vien                            - Get students list âœ…
PUT  /api/pdt/sinh-vien/{id}                       - Update student âœ…
DELETE /api/pdt/sinh-vien/{id}                     - Delete student âœ…
POST /api/pdt/mon-hoc                              - Create course âœ…
GET  /api/pdt/mon-hoc                              - Get courses list âœ…
PUT  /api/pdt/mon-hoc/{id}                         - Update course âœ…
DELETE /api/pdt/mon-hoc/{id}                       - Delete course âœ…
POST /api/pdt/giang-vien                           - Create instructor âœ…
GET  /api/pdt/giang-vien                           - Get instructors list âœ…
PUT  /api/pdt/giang-vien/{id}                      - Update instructor âœ…
DELETE /api/pdt/giang-vien/{id}                    - Delete instructor âœ…
POST /api/pdt/demo/toggle-phase                    - Toggle phase (demo) âœ…
POST /api/pdt/demo/reset-data                      - Reset demo data âœ…
POST /api/pdt/ky-phase/toggle                      - Toggle phase âœ…
```

### Step 11: BÃ¡o CÃ¡o (Reports) Module

**Status: IMPLEMENTED** âœ…

```
GET  /api/bao-cao/overview                - Get overview statistics âœ…
GET  /api/bao-cao/dk-theo-khoa            - Get registrations by department âœ…
GET  /api/bao-cao/dk-theo-nganh           - Get registrations by specialization âœ…
GET  /api/bao-cao/tai-giang-vien          - Get instructor workload âœ…
GET  /api/bao-cao/export/excel            - Export report to Excel âœ…
GET  /api/bao-cao/export/pdf              - Export report to PDF âœ…
```

---

## ğŸ“‹ Phase 3: Database & ORM Models (CURRENT)

### Database Setup

- [x] Generate models tá»« Neon DB
- [x] Copy models vÃ o `infrastructure/persistence/models.py`
- [x] Configure database routing

---

## ğŸ“‹ Phase 4: Test & Validation

---

## ğŸ¯ Next Priority: Optimization & Documentation

### Tasks:

1. **Clean Architecture Implementation**

   - [ ] Refactor existing views to use use-cases
   - [ ] Extract business logic to domain layer
   - [ ] Implement proper DTOs for all endpoints

2. **Test Coverage**

   - [ ] Add unit tests for all use-cases
   - [ ] Add integration tests for repositories
   - [ ] Add E2E tests for critical flows

3. **Documentation**

   - [ ] API documentation (OpenAPI/Swagger)
   - [ ] Database schema documentation
   - [ ] Architecture decision records (ADRs)

4. **Performance & Security**

   - [ ] Add caching layer (Redis)
   - [ ] Implement rate limiting
   - [ ] Add audit logging
   - [ ] Security headers & CORS policy

5. **Deployment**
   - [ ] Docker setup verification
   - [ ] CI/CD pipeline setup
   - [ ] Database migration strategy

---

## ï¿½ Endpoint Summary by Module

| Module                | Endpoints | Status             |
| --------------------- | --------- | ------------------ |
| Authentication        | 2         | âœ… IMPLEMENTED     |
| Master Data           | 7         | âœ… IMPLEMENTED     |
| Sinh ViÃªn (SV)        | 3         | âœ… IMPLEMENTED     |
| Ghi Danh (Enrollment) | 4         | âœ… IMPLEMENTED     |
| ÄÄƒng KÃ½ (Course Reg)  | 13        | âœ… IMPLEMENTED     |
| Payment               | 3         | âœ… IMPLEMENTED     |
| Giáº£ng ViÃªn (GV)       | 9         | âœ… IMPLEMENTED     |
| Trá»£ LÃ½ Khoa (TLK)     | 8         | âœ… IMPLEMENTED     |
| TrÆ°á»Ÿng Khoa (TK)      | 3         | âœ… IMPLEMENTED     |
| PDT Management        | 39        | âœ… IMPLEMENTED     |
| Reports (BÃ¡o CÃ¡o)     | 6         | âœ… IMPLEMENTED     |
| **TOTAL**             | **97**    | âœ… **IMPLEMENTED** |

---

```txt
djangorestframework>=3.14.0
djangorestframework-simplejwt>=5.3.0
django-cors-headers>=4.3.1
pytest>=7.4.0
pytest-django>=4.5.0
factory-boy>=3.3.0      # Test fixtures
faker>=20.0.0           # Fake data
```
